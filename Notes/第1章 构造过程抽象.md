# 1 构造过程抽象

计算过程，巫术

用Lisp表示过程性的思想

选择的原因：计算过程的Lisp描述本身又可以作为Lisp的数据来表示和操作。

## 1.1 程序设计的基本元素

基本表达式

组合的方法

抽象的方法

### 1.1.1 表达式

组合式

前缀表示

- 完全适用于可能带有任意个实参的过程
- 可以直接扩充，允许出现组合式嵌套的情况

嵌套的组合式

- 美观打印

### 1.1.2 命名和环境

变量 `(define size 2)`

- 递增开发，一个define是一个简单的抽象

名字-值，存储：环境（全局环境）

- 一个计算过程完全可能设计若干不同环境

### 1.1.3 组合式求值

递归

把组合式表示成一棵树

终端节点的值

1. 数：它所表示的值
2. 运算符（+-*）：能完成相应操作的机器指令序列
3. 其他名字：环境中关联这一名字的对象

**环境**（具有普遍性的概念）

- 用于确定表达式中各个符号的意义（提供上下文）

**注意**： 以上所说为一般性求值规则，`(define x 2)`是特殊形式，并不是一个组合式。

Lisp

- 一个简单规则
- 一组针对不多的特殊形式的专门规则（eg: define）

【记】

看SICP前，知道Lisp会有很多括号，但是没有想到怎么运算和执行过程。

1. 看目录，第一章过程抽象，第一感觉是类似C的函数，提取一个过程为一个函数，第二章的数据抽象，类比想的是数据结构概念，对数据的抽象，第二是类似C++类，对数据的抽象
2. 到这里，看到运算符也是类似全局变量，是环境提供意义（指令序列），和C++思考不一样了，感觉是更加底层了，比如字节码中函数的地址，+运算符和函数定义一样，+去对应字节码中函数地址，该做什么。这样把数据的key value和运算的操作符、具体实现 统一了起来。
3. 超级简单的规则，以及和语法树最终形态十分相似的组合表达式，对于解释器的实现十分友好。

### 1.1.4 复合过程

过程定义

```scheme
(define (<name> <formal parameters>) <body>)
```

eg

```scheme
(define (square x) (* x x))
(define (sum-of-squares x y)
  (+ (square x) (square y)))
```

square和sum-of-squares是复合过程的名字

类比

```scheme
(+ 1 3)
(sum-of-squares 1 3)
```

单从上面的两个组合式，形式上无法无法分辨sum-of-squares是直接做在解释器中（和+一样），还是被定义为一个复合过程。

### 1.1.5 过程应用的替换模型

> 将复合过程应以哦那个与实际参数，就是在将过程体中的每个形参用相应的实参取代之后，对这一过程体求值。

一步步用实参取代求值的过程，称为过程应用的代换模型。

代换模型是理解的起点，后续修正。

【记】

从最简单的不完全的模型开始，修正模型的过程，有点像练拳，第一阶段动作不标准，后续修正。

**应用序**：先求值参数而后应用（Lisp采用的方式）

**正则序**：完全展开而后归约（存在重复求值的情况）

### 1.1.6 条件表达式和谓词

分情况分析（Lisp的一个特殊形式，称为cond）

```scheme
(cond (<p1> <e1>)
      (<p2> <e2>)
      ...
      (<pn> <en>))
```

子句`(<p1> <e1>)`表达式对偶，p1是一个谓词，这个表达式被解释为真或假。

依次看p1,p2...是否为真，如果无法找到为真的p，cond的值就没有定义。

eg: x绝对值

```scheme
(define (abs x)
  (cond ((> x 0) x)
        ((= x 0) 0)
        ((< x 0) (-x)))
```

abs变体

```scheme
(define (abs x)
  (cond ((< x 0) (-x))
        (else x)))
```

else 特殊字符

if 条件表达式的一种受限形式

```scheme
(define (abs x)
  (if (< x 0)
      (-x)
      x))
```

if的一般形式

```scheme
(if <predicate><consequent><alternative>)
```

谓词：返回真或假的过程、也指能求出真假的表达式

- `< = >`基本谓词
- and or not 逻辑复合运算符，构造出复合谓词

**注意**：and or 是特殊形式（子表达式不一定都求值），not是一般形式

